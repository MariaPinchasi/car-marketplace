
const carAgencyManager={
    agencies: [
        {
          agencyName: "Best Deal",
          cash: 1245000,
          credit: 200000,
          agencyId: "Plyq5M5AZ",
      // מערך שמכיל סוכנויות, סוכנות= אובייקט שמכיל: שם, מזומן, קרדיט, תעודת זהות ומערך של מכוניות. 
      // המערך מכיל אובייקטים של מותגים- כל אובייקט מכיל מותג ומערך של מודלים. 
      // כל מודל הוא אובייקט עם שם, שנה,מחיר, מספר ותעודת זהות של הבעלים.
          cars: [
            {
              brand: "bmw",
              models: [
                {
                  name: "3",
                  year: 2015,
                  price: 137000,
                  carNumber: "AZJZ4",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "X6",
                  year: 2020,
                  price: 966500,
                  carNumber: "S6DL1",
                  ownerId: "Plyq5M5AZ",
                },
              ],
            },
            {
              brand: "toyota",
              models: [
                {
                  name: "Land Cruiser",
                  year: 2020,
                  price: 336300,
                  carNumber: "6rvXw",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Hilux",
                  year: 2005,
                  price: 35005,
                  carNumber: "MWXBG",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Corolla",
                  year: 2020,
                  price: 111900,
                  carNumber: "hCzl-",
                  ownerId: "Plyq5M5AZ",
                },
              ],
            },
            {
              brand: "Ford",
              models: [
                {
                  name: "Focus",
                  year: 2020,
                  price: 98200,
                  carNumber: "kN3HP",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Focus",
                  year: 2005,
                  price: 6502,
                  carNumber: "LJTCs",
                  ownerId: "Plyq5M5AZ",
                },
              ],
            },
            {
              brand: "Alpha romeo",
              models: [
                {
                  name: "Romeo Julia",
                  year: 2020,
                  price: 275406,
                  carNumber: "2kjy7",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Romeo Stelvio",
                  year: 2019,
                  price: 215403,
                  carNumber: "7A5b-",
                  ownerId: "Plyq5M5AZ",
                },
              ],
            },
            {
              brand: "Chevrolet",
              models: [
                {
                  name: "Traverse",
                  year: 2020,
                  price: 201102,
                  carNumber: "QwBOT",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Impala",
                  year: 2019,
                  price: 165041,
                  carNumber: "2v4jt",
                  ownerId: "Plyq5M5AZ",
                },
                {
                  name: "Malibu",
                  year: 2017,
                  price: 75405,
                  carNumber: "O4_Jv",
                  ownerId: "Plyq5M5AZ",
                },
              ],
            },
          ],
        },
        {
          agencyName: "CarMax",
          cash: 968541,
          credit: 500000,
          agencyId: "26_IPfHU1",
          cars: [
            {
              brand: "bmw",
              models: [
                {
                  name: "X5",
                  year: 2015,
                  price: 218000,
                  carNumber: "4Ixb0",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "X6",
                  year: 2014,
                  price: 97100,
                  carNumber: "kAnv-",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "Z4",
                  year: 2019,
                  price: 296900,
                  carNumber: "ISMdU",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "3",
                  year: 2010,
                  price: 75100,
                  carNumber: "9DJPw",
                  ownerId: "26_IPfHU1",
                },
              ],
            },
            {
              brand: "toyota",
              models: [
                {
                  name: "Land Cruiser",
                  year: 2005,
                  price: 80540,
                  carNumber: "Kt-pW",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "Corolla",
                  year: 2019,
                  price: 109100,
                  carNumber: "YiYdI",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "Hilux",
                  year: 2019,
                  price: 204000,
                  carNumber: "DRmNw",
                  ownerId: "26_IPfHU1",
                },
              ],
            },
            {
              brand: "Ford",
              models: [
                {
                  name: "F250",
                  year: 2020,
                  price: 198500,
                  carNumber: "g4Wfp",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "Explorer",
                  year: 2020,
                  price: 265200,
                  carNumber: "iNT8Q",
                  ownerId: "26_IPfHU1",
                },
              ],
            },
            {
              brand: "Alpha romeo",
              models: [
                {
                  name: "Spider",
                  year: 2011,
                  price: 75405,
                  carNumber: "6t7QU",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "166",
                  year: 2002,
                  price: 12400,
                  carNumber: "XMqpn",
                  ownerId: "26_IPfHU1",
                },
              ],
            },
            {
              brand: "Chevrolet",
              models: [
                {
                  name: "Impala",
                  year: 2016,
                  price: 65042,
                  carNumber: "vbeAo",
                  ownerId: "26_IPfHU1",
                },
                {
                  name: "Savannah",
                  year: 2016,
                  price: 76505,
                  carNumber: "WelWa",
                  ownerId: "26_IPfHU1",
                },
              ],
            },
          ],
        },
    ],
// 1 getAgencyByName
// @param {string} - name
// @return { Object} - agency object if found, otherwise null
    getAgencyByName: function (name) {
        const searchedAgency= this.agencies.find(agency=>agency.agencyName===name);
        return searchedAgency||null;    
    }, 
// 2 getAgencyById
// @param {String} - agencyId
// @return {object} - agency object if found, otherwise null
    getAgencyById: function (agencyId) {
        const searchedAgencyID= this.agencies.find(agency=>agency.agencyId===agencyId); 
        return searchedAgencyID || null;   
    },
// 3 getAllAgenciesName
// @return {string[]} - agenciesNameArr - Array of all agencies name
    getAllAgenciesName: function () {
        return this.agencies.map(agency=>agency.agencyName);
    },
// 4 Add a new car to an agency's inventory.
// @param {string} agencyId - The ID of the agency
// @param {object} car - The car object to be added
// @return {boolean} - true if added successfully, false otherwise
    addCarToAgency: function (agencyId, car) {
        const searchedAgency= this.getAgencyById(agencyId);
        if (searchedAgency) {
            searchedAgency.cars.find(carObj=>carObj.brand===car.brand).models.push(car.models[0]);
            return true;
         }
         return false;
    },

// 5 Remove a car from an agency's inventory.
// @param {string} agencyId - The ID of the agency
// @param {string} carId - The ID of the car to be removed-car number
// @return {boolean} - true if removed successfully, false otherwise
    removeCarFromAgency: function (agencyId, carId) {
        const searchedAgency= this.getAgencyById(agencyId);
        const searchCarModel=searchedAgency.cars.find(carObj=>carObj.models.find(carNum=>carNum.carNumber===carId));
        if (searchedAgency&&searchCarModel){
            searchedAgency.cars.map(carObj=>carObj.models=carObj.models.filter(model=>model.carNumber!==carId));
            return true;
        }
        return false;
    },

// 6 Change the cash or credit of an agency.
// @param {string} agencyId - The ID of the agency
// @param {string} cashOrCredit - type of cash or credit to be updated
// @param {number} cashOrCredit - The amount of cash or credit to be updated
// @return {boolean} - true if updated successfully, false otherwise
    changeAgencyCashOrCredit: function (agencyId, cashOrCreditStr,cashOrCreditAmount) {
        const searchedAgency= this.getAgencyById(agencyId);
        if(searchedAgency) {
            searchedAgency[cashOrCreditStr]=cashOrCreditAmount;
            return true;
        }
        return false;
    },

// 7 Update the price of a specific car in an agency.
// @param {string} agencyId - The ID of the agency
// @param {string} carId - The ID of the car
// @param {number} newPrice - The new price of the car
// @return {boolean} - true if updated successfully, false otherwise
    updateCarPrice: function (agencyId, carId, newPrice) {
        const searchedAgency= this.getAgencyById(agencyId);
        const searchCarModel=searchedAgency.cars.find(carObj=>carObj.models.find(carModel=>carModel.carNumber===carId));
        if (searchedAgency&&searchCarModel){
            searchedAgency.cars.map(carObj=>carObj.models.find(carModel=>{
                if (carModel.carNumber===carId) {
                    carModel.price=newPrice;
                }
            }));
            return true;
        }
        return false;
    },

// 8 Calculate and return the total revenue for a specific agency.
// @param {string} agencyId - The ID of the agency
// @return {number} - The total revenue of the agency
    getTotalAgencyRevenue: function (agencyId) {
        const searchedAgency= this.getAgencyById(agencyId);
        return searchedAgency? searchedAgency.cash+searchedAgency.credit : 'agency not found';

    },

// 9 Transfer a car from one agency to another.
// @param {string} fromAgencyId - The ID of the agency from where the car will be transferred
// @param {string} toAgencyId - The ID of the agency to where the car will be transferred
// @param {string} carId - The ID of the car to be transferred
// @return {boolean} - true if transferred successfully, false otherwise
    transferCarBetweenAgencies: function (fromAgencyId, toAgencyId, carId) {
        const searchedFromAgency= this.getAgencyById(fromAgencyId);
        const searchCarModel={...searchedFromAgency.cars.find(carObj=>carObj.models.find(carModel=>carModel.carNumber===carId))};
        const searchedToAgency= this.getAgencyById(toAgencyId);
        if (searchedFromAgency&&searchedToAgency&&searchCarModel){
            searchCarModel.models=searchCarModel.models.filter(model=>model.carNumber===carId);            
            this.addCarToAgency(toAgencyId,searchCarModel);
            this.removeCarFromAgency(fromAgencyId,carId);
            return true;
        }
        return false;
    },
// 10 getAllCarToBuy-from previous index
// @return {object[]} - allCarsToBuy - arrays of all cars objects
    getAllCarToBuy: function () {
        return this.agencies.flatMap (agencyObj=> agencyObj.cars).flatMap(carObj=>{
            const newArr=[];
            for(let model of carObj.models){
                newArr.push({brand:carObj.brand,...model});
            }
            return newArr;
        }); 
    },
// 11 getAllCarToBuyByAgencyId-from previous index
// @param {string} - id of agency
// @return {object[]} - carsArray - arrays of all models objects of specific agency
    getAllCarToBuyByAgencyId: function (agencyId) {
        return this.agencies.find(agency=>agency.agencyId===agencyId).cars.flatMap(carsObj=>carsObj.models);
    },
// 12 getAllBrandsToBuyAgencyId-from previous index
// @param {string} - agencyId -  id of agency
// @return {string[]} - arrOfBrands - arrays of all brands name in specific agency
    getAllBrandsToBuyAgencyId: function (agencyId) {
        return this.agencies.find(agency=>agency.agencyId===agencyId).cars.map(carObj=>carObj.brand);
    },
    
}

// agencies check /////////////////////////////////////////////////////////////////////////
const carToCheck={
    brand: "bmw",
    models: [
      {
        name: "3",
        year: 2015,
        price: 137000,
        carNumber: "newAZJZ45",
        ownerId: "Plyq5M5AZ",
      },
    ],
  };
console.log('1' , carAgencyManager.getAgencyByName('Best Deal'));
console.log('2' , carAgencyManager.getAgencyById('Plyq5M5AZ'));
console.log('3' , carAgencyManager.getAllAgenciesName());
console.log('4' , carAgencyManager.addCarToAgency('Plyq5M5AZ',carToCheck));
console.log('4-10' , carAgencyManager.getAllCarToBuy());
console.log('5' , carAgencyManager.removeCarFromAgency('Plyq5M5AZ','newAZJZ45'));
console.log('5-10' , carAgencyManager.getAllCarToBuy());
console.log('6' , carAgencyManager.changeAgencyCashOrCredit('Plyq5M5AZ','cash',1500));
console.log('6-1' , carAgencyManager.getAgencyByName('Best Deal'));
console.log('7' , carAgencyManager.updateCarPrice('Plyq5M5AZ','AZJZ4',150000));
console.log('7-10' , carAgencyManager.getAllCarToBuy());
console.log('8' , carAgencyManager.getTotalAgencyRevenue('Plyq5M5AZ'));
console.log('9' , carAgencyManager.transferCarBetweenAgencies('Plyq5M5AZ','26_IPfHU1','QwBOT'));
console.log('10' , carAgencyManager.getAllCarToBuy());
console.log('11' , carAgencyManager.getAllCarToBuyByAgencyId("Plyq5M5AZ"));
console.log('12' , carAgencyManager.getAllBrandsToBuyAgencyId("Plyq5M5AZ"));
console.log('////////////////////////////////////////////////////////////////////////////////')

// end of agencies check/////////////////////////////////////////////////////////////////////////////


const CustomerManager = {
    customers: [ {
        name: "Lilah Goulding",
        id: "BGzHhjnE8",
        cars: [
          {
            name: "Corolla",
            year: 2013,
            price: 40570,
            carNumber: "16da1",
            ownerId: "BGzHhjnE8",
          },
        ],
        cash: 35000,
      },
      {
        name: "Ravi Murillo",
        id: "2RprZ1dbL",
        cars: [
          {
            name: "M5",
            year: 2019,
            price: 578054,
            carNumber: "WIh0U",
            ownerId: "2RprZ1dbL",
          },
          {
            name: "Spider",
            year: 2012,
            price: 81520,
            carNumber: "RLS4q",
            ownerId: "2RprZ1dbL",
          },
        ],
        cash: 278542,
      },
    ],
  
// 1 Search for a customer by their name or ID.
// @param {string} idOrName - ID or name of the customer
// @return {object} - customer object if found, otherwise null
    searchCustomer: function (idOrName) {
        const searchesCustomer= this.customers.find(customer=>customer.name===idOrName|| customer.id===idOrName);
        return searchesCustomer? searchesCustomer : null;
    },
  
// 2 Retrieve all customers' names.
// @return {string[]} - Array of customer names
    getAllCustomers: function () {
        return this.customers.map(customer=>customer.name);
  
    },
  
// Change the cash of a customer.
// @param {string} customerId - The ID of the customer
// @param {number} cash - The new cash value
// @return {boolean} - true if updated successfully, false otherwise
    changeCustomerCash: function (customerId, cash) {
        const searchedCustomer=this.searchCustomer(customerId);
        if (searchedCustomer){
            searchedCustomer.cash=cash;
            return true;
        }
        return false;
    },
  
// 4 Calculate the total value of all cars owned by a specific customer.
// @param {string} customerId - The ID of the customer
// @return {number} - The total value of cars owned by the customer
    getCustomerTotalCarValue: function (customerId) {
        const searchedCustomer=this.searchCustomer(customerId);
        if (searchedCustomer){
            return searchedCustomer.cars.reduce((sum,car)=>sum+=car.price,0);
        }
        return 'customer not found';
    },
  };

//   customer check /////////////////////////////////////////////////////
console.log('customer 1', CustomerManager.searchCustomer('Ravi Murillo'));
console.log('customer 2', CustomerManager.getAllCustomers());
console.log('customer 3', CustomerManager.changeCustomerCash('2RprZ1dbL',1300));
console.log('customer 3-1', CustomerManager.searchCustomer('Ravi Murillo'));
console.log('customer 4', CustomerManager.getCustomerTotalCarValue('2RprZ1dbL'));
console.log('////////////////////////////////////////////////////////////////////////////////')

//   end of customer check /////////////////////////////////////////////////////

  

const carManager={
// 1 getAllCarToBuy
// @return {object[]} - allCarsToBuy - arrays of all cars objects
    getAllCarToBuy: function () {
        return carAgencyManager.agencies.flatMap (agencyObj=> agencyObj.cars).flatMap(carObj=>{
            const newArr=[];
            for(let model of carObj.models){
            newArr.push({brand:carObj.brand,...model});
        }
        return newArr;
    }); 
},
// Search for cars based on certain criteria.
// @param {number} year - The production year of the car
// @param {number} price - The price of the car
// @param {string} brand - The brand of the car
// @return {object[]} - Array of cars that meet the criteria
  searchCars: function (year, price, brand) {
    return this.getAllCarToBuy().filter(car=>car.year===year&&car.price===price&&car.brand===brand)
  },

  // Return the most expensive car available for sale.
  // @return {object} - The most expensive car
  getMostExpensiveCar: function () {
    let mostExpansiveCar;
    this.getAllCarToBuy().reduce((maxPrice,car)=>{
        if (car.price>maxPrice) {
            maxPrice=car.price;
            mostExpansiveCar=car;
         } 
         return maxPrice;
    },0);
    return mostExpansiveCar;
  },

  // Return the cheapest car available for sale.
  // @return {object} - The cheapest car
  getCheapestCar: function () {
    let cheapestCar=this.getAllCarToBuy()[0];
    let minPrice=this.getAllCarToBuy()[0].price;
    console.log(minPrice);
    this.getAllCarToBuy().reduce((minPrice,car)=>{
        if (car.price<minPrice) {
            minPrice=car.price;
            cheapestCar=car;
         } 
         return minPrice;
    },minPrice);
    return cheapestCar;
  },
};
// carManager check
console.log('1 CarManager',carManager.getAllCarToBuy());
console.log('2 CarManager',carManager.searchCars(2005,35005,'toyota'));
console.log('3 CarManager',carManager.getMostExpensiveCar());
console.log('4 CarManager',carManager.getCheapestCar());
console.log('//////////////////////////////////////////////////////////////////')
// carManager check end

const CarPurchaseManager = {
  
    taxesAuthority: {
      totalTaxesPaid: 0,
      sumOfAllTransactions: 0,
      numberOfTransactions: 0,
    },
  
// 1 Implement a sellCar function that sells a car to a specific customer.
// @param {string} carId - The ID of the car
// @param {string} customerId - The ID of the customer
// @return {boolean} - true if the car was sold successfully, false otherwise
    sellCar: function (carId, customerId) {
        const customer=CustomerManager.searchCustomer(customerId);
        const agency=carAgencyManager.agencies.find(agency=>agency.cars.find(car=>car.models.find(model=>model.carNumber===carId)));
        const car=agency.cars.find(car=>car.models.find(model=>model.carNumber===carId));
        const model=car.models.find(model=>model.carNumber===carId);
        if (model&&customer){
            const priceWithTax=model.price+(model.price*0.17);
            if (customer.cash>=priceWithTax){
                customer.cash-=priceWithTax;
                agency.cash+=priceWithTax;
                model.ownerId=customer.id;
                carAgencyManager.removeCarFromAgency(agency.agencyId,model.carNumber);
                customer.cars.push(model);
                this.taxesAuthority.totalTaxesPaid+=model.price*0.17;
                this.taxesAuthority.numberOfTransactions+=1;
                this.taxesAuthority.sumOfAllTransactions+=priceWithTax;
                console.log(this.taxesAuthority);
                return true;
            }
            else return 'The customer does not have enough money';
        }
        else 'The vehicle does not exist at the agency or customer not registered'
    },
  
// 2 Calculate and return the total revenue of the entire market.
// @return {number} - The total revenue of the market
    getTotalMarketRevenue: function () {
        const totalCashAgencies=carAgencyManager.agencies.reduce((total,agency)=>total+=agency.cash,0);
        const totalCashCustomers= CustomerManager.customers.reduce((total,customer)=>total+=customer.cash,0);
        return totalCashAgencies+totalCashCustomers;       
    },
  };
// check taxes
  console.log('1 taxes',CarPurchaseManager.sellCar('LJTCs', 'BGzHhjnE8'));
  console.log('2 taxes',CarPurchaseManager.getTotalMarketRevenue());

